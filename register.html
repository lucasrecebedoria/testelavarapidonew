<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registrar</title>
  <link rel="icon" href="icon.ico">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <div class="logo-left">
    <img src="logo.png" class="logo">
    <div class="title">Registro</div>
  </div>
</header>
<div class="container">
  <div class="card">
    <h2>Novo usuário</h2>
    <div class="row">
      <div class="col"><label>Matrícula</label><input id="matricula"></div>
      <div class="col"><label>Senha</label><input id="senha" type="password"></div>
    </div>
    <div class="row">
      <div class="col"><button id="createBtn" class="metal">Criar conta</button></div>
      <div class="col"><a href="index.html"><button class="steel">Voltar ao login</button></a></div>
    </div>
  </div>
</div>
<div class="footer">Developed by Lucas L Custodio, V1</div>
<script type="module">
import { auth, db, createUserWithEmailAndPassword, doc, setDoc } from "./scripts/firebase.js";

document.getElementById('createBtn').addEventListener('click', async ()=>{
  const m = document.getElementById('matricula').value.trim();
  const email = `${m}@movebuss.local`;
  const pass = document.getElementById('senha').value;
  try{
    const cred = await createUserWithEmailAndPassword(auth, email, pass);
    await setDoc(doc(db,"usuarios", m), { matricula:m, email, admin: ["12","6266","1778"].includes(m) });
    alert("Conta criada!");
    window.location.href="index.html";
  }catch(e){ alert("Erro ao criar: "+e.message); }
});
</script>
</body>
</html>
