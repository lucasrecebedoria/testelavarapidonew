<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Registrar • Move Buss</title>
  <link rel="icon" href="assets/favicon.ico"/>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
<header class="header">
  <img src="assets/logo.png"/>
  <div class="spacer"></div>
  <a class="btn" href="index.html">Voltar</a>
</header>
<main class="container">
  <div class="card">
    <h2>Novo usuário</h2>
    <div class="grid cols-2">
      <div>
        <div class="label">Matrícula</div>
        <input id="matricula" class="input" placeholder="ex: 6266"/>
      </div>
      <div>
        <div class="label">Senha</div>
        <input id="senha" type="password" class="input"/>
      </div>
    </div>
    <button id="btn" class="btn green" style="margin-top:14px">Criar</button>
  </div>
</main>
<footer class="footer">Developed by Lucas L Custodio, V1</footer>
<script type="module">
  import { auth, db, emailFromMatricula, ADM_MATRICULAS } from './js/firebase.js';
  import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  const $=(q)=>document.querySelector(q);
  document.getElementById('btn').addEventListener('click', async ()=>{
    const m=$('#matricula').value.trim(); const p=$('#senha').value;
    if(!m||!p) return alert('Preencha os campos.');
    try{
      const email=emailFromMatricula(m);
      const {user}=await createUserWithEmailAndPassword(auth,email,p);
      const role = ADM_MATRICULAS.includes(m)?'admin':'user';
      await setDoc(doc(db,'usuarios', user.uid),{matricula:m,email,role, createdAt: serverTimestamp()});
      alert('Conta criada! Faça login.');
      location.href='index.html';
    }catch(e){ alert('Erro: '+e.message); }
  });
</script>
</body>
</html>